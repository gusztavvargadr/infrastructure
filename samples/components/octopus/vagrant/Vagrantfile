require "#{File.dirname(__FILE__)}/../../core/vagrant/Vagrantfile.core"
require "#{File.dirname(__FILE__)}/../../../../src/components/octopus/vagrant/Vagrantfile.core"

Environment.core(
  octopus: {
    server: {
      hostname: 'server.octopus.local',
      api_key: 'API-6ENORPWQM3NWT7G6P47W5USM',
      thumbprint: '72D090FFBAD730D24084D9E68691E782ADBAAC4C',
    },
    tentacle: {
      environment_names: ['test'],
      tenant_names: ['private'],
    },
  }
)

Provider.core(memory: 2048, cpus: 1)

Environment.new(name: 'octopus.local') do |environment|
  WindowsSampleVM.new(environment, name: 'server', box: 'gusztavvargadr/w16s-sql14d') do |server|
    server.vagrant.vm.synced_folder "#{File.dirname(__FILE__)}/../core", '/vagrant-core'

    OctopusServer.new(
      server,
      chef_json: {
        'gusztavvargadr_octopus' => {
          'server' => {
            'import' => {
              'C:\\vagrant-core\\server\\import' => {
                'password' => 'Octopus42',
              },
            },
          },
        },
      }
    )
  end

  WindowsSampleVM.new(environment, name: 'tentacle', box: 'gusztavvargadr/w16s') do |tentacle|
    OctopusTentacle.new(
      tentacle,
      chef_json: {
        'gusztavvargadr_octopus' => {
          'tentacle' => {
            'role_names' => ['tentacle'],
          },
        },
      }
    )
  end
end
